<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://fonts.googleapis.com/css?family=Press Start 2P' rel='stylesheet'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
  <title>Jogo da Forca</title>
</head>

<body>
  <main>
    <div id="game">
      <div>
        <img src="https://upload.wikimedia.org/wikipedia/commons/9/98/International_Pok%C3%A9mon_logo.svg" alt="Pokemon Logo">
      </div>
      <h2>Jogo da forca</h2>
      <div id="ganhou">
        Parabéns você ganhou!
      </div>
      <div id="perdeu">
        Você perdeu!
      </div>
      <button id="button" onclick="playGame()">Iniciar Jogo</button>
    </div>
  </main>
</body>
<script>
  window.document.onload = ocultarResultado();
  const endPoint = "https://pokeapi.co/api/v2/pokemon/";
  const forca = [
    `    _______
    |       O
    |       /|\\
    |       / \\
    |`,
    `    _______
    |       O
    |       /|\\
    |       / 
    |`,
    `    _______
    |       O
    |       /|\\
    |    
    |`,
    `    _______
    |       O
    |       /|
    |
    |`,
    `    _______
    |       O
    |        |
    |    
    |`,
    `    _______
    |       O
    |    
    |    
    |`
  ];
  let palavras;
  let letrasUsadas;
  let numeroTentativas;
  let numeroTentativasRestante;
  let numeroJogadasErradas;
  let palavra;
  let palavraEncontrada;
  let palavraBuscada;
  let jogar;
  let ganhou;

  // Obter lista de Pokemons (Somente 20 itens)
  function requestPokeList() {
    return fetch(endPoint)
      .then(response => response.json())
      .catch(err => console.log(err));
  }

  // Função principal do jogo
  async function playGame() {
    await ocultarResultado();
    await inicializarVariaveis();
    let letra;
    while (jogar) {
      letra = obterLetra();
      if (letra === null) {
        jogar = false;
      } else {
        buscarLetra(letra);
        verificarFimPartida();
      }
    }

    // if (ganhou) {
    //   alert("Parabéns você ganhou!");
    // } else {
    //   alert("Você perdeu!");
    // }
    exibirResultado(ganhou);
  }

  // Obter letra 
  function obterLetra() {
    let letraObtida;
    let dica;
    do {
      dica = palavraEncontrada.toString().replaceAll(",", " ");
      letraObtida = prompt(
        `Dica: ${dica}\nNúmero de tentativas restante: ${numeroTentativasRestante}\nLetras utilizadas: ${letrasUsadas}\nDigite uma letra:`
      );
    } while (validarLetra(letraObtida));
    return letraObtida !== null ? letraObtida.toLocaleLowerCase() : null;
  }

  function validarLetra(letra) {
    const caracteresValidos = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j',
      'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'
    ];

    if (letra !== null) {
      if (caracteresValidos.includes(letra.toLocaleLowerCase())) {
        if (letrasUsadas.includes(letra.toLocaleLowerCase())) {
          alert("Letra já utilizada!");
          return true;
        }
        return false;
      } else if (letra.trim().length === 0) {
        alert("Informe algum valor!");
        return true;
      } else {
        alert("Digite uma letra!");
        return true; // Caso o valor não pertença no array
      }
    } else {
      return false; // Retorno do botão cancelar do prompt
    }
  }

  function buscarLetra(letra) {
    if (palavraBuscada.includes(letra)) {
      for (let i = 0; i < palavra.length; i++) {
        if (palavra.charAt(i) === letra) {
          palavraEncontrada[i] = letra;
          palavraBuscada = palavraBuscada.replace(letra, "");
        }
        if (!palavraBuscada.includes(letra)) {
          break;
        }
      }
      letrasUsadas.push(letra);
    } else {
      letrasUsadas.push(letra);
      numeroTentativasRestante--;
      numeroJogadasErradas++;
      alert(`${forca[numeroTentativasRestante]}
      Letra não encontrada!`);
    }
  }

  function verificarFimPartida() {
    if (palavraBuscada.length > 0 && numeroJogadasErradas === numeroTentativas) {
      jogar = false;
      ganhou = false;
    } else if (palavraBuscada.length === 0 && numeroJogadasErradas <= numeroTentativas) {
      jogar = false;
      ganhou = true;
    }
  }

  async function inicializarVariaveis() {
    if (palavras === undefined) {
      await requestPokeList().then(data => {
        responseData = data;
        palavras = responseData.results.map((pokemon) => pokemon.name);
      });
    }

    palavra = palavras[Math.floor((Math.random() * palavras.length))];
    palavraEncontrada = palavra.split('').map(() => '*');
    palavraBuscada = palavra;
    letrasUsadas = [];
    numeroTentativas = 6;
    numeroTentativasRestante = 6;
    numeroJogadasErradas = 0;
    jogar = true;
    ganhou = false;
  }

  function exibirResultado(ganhou) {
    if (ganhou) {
      document.getElementById("ganhou").style.display = "block";
    } else {
      document.getElementById("perdeu").style.display = "block";
    }
  }

  async function ocultarResultado() {
    document.getElementById("ganhou").style.display = "none";
    document.getElementById("perdeu").style.display = "none";
  }
</script>

</html>